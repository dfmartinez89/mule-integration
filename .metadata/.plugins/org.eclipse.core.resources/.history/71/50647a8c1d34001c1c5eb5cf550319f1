package actividad1ejercicio4;

import org.mule.api.MuleEventContext;
import org.mule.api.lifecycle.Callable;

public class CalcularDivisa implements Callable {
	private String input;
	float dollar;
	float euro;
	String MensajeError = "Valor de entrada incorrecto";

	@Override
	public Object onCall(MuleEventContext eventContext) {
		try {
			input = eventContext.getMessage().getInboundProperty("http.request.path");
			urlBuena();
			dollarBueno();
			return convertirDollarEuro();
		} catch (Exception e) {
			return MensajeError;
		}
	}

	public void urlBuena() {
		if (!input.contains("/dollar2eur/")) {
			throw new Error(MensajeError);
		}
	}

	public void dollarBueno() {
		String valorEntrada = input.substring(12);
		if (!Float.isNaN(Float.valueOf(valorEntrada))) {
			throw new Error(MensajeError);
		} else if (Float.valueOf(valorEntrada) > 0) {
			dollar = Float.valueOf(valorEntrada);
		}
		throw new Error(MensajeError);
	}

	public String convertirDollarEuro() {
		dollar = Float.parseFloat(input.substring(12));
		if (dollar > 0) {
			euro = (float) (dollar * 0.86);
			return ("El valor en euros es " + Float.toString(euro));
		} else {
			throw new Error(MensajeError);
		}
	}
}
